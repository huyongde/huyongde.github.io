---
layout: default
---
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">{{ page.title }}</h1>
    <p class="post-meta"><time datetime="{{ page.date | date_to_xmlschema }}" itemprop="datePublished">{{ page.date | date: "%b %-d, %Y" }}</time>{% if page.author %} • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">{{ page.author }}</span></span>{% endif %}</p>
  </header>

  <div class="post-content" itemprop="articleBody">
    {{ content }}
  </div>


</article>

<hr>
<div style="float:left">
<h3 class="page-heading">Related Posts:</h3>

{% comment %} 利用split 来形成一个空数组, 这里主要是我不知道liquid如何直接写array... {% endcomment %} 
{% assign postsAfterFilter = '-' | split: "-" %}
{% for post in site.related_posts %}
  {% assign commonTagCount = 0 %}
  {% if post.title != page.title and post.series != page.series %}
    {% for tag in post.tags %} 
      {% if page.tags contains tag %}

        {% comment %} 统计共同的tag的数目, 用来后面的筛选以及排序用 {% endcomment %} 
        {% assign commonTagCount = commonTagCount | plus: 1 %}
      {% endif %}
    {% endfor %}
    {% if commonTagCount > 0 %}

      {% comment %} 将符合条件的post放入一个新的数组之中 {% endcomment %} 
      {% assign postsAfterFilter = postsAfterFilter | push: post %}
    {% endif %}
  {% endif %}
{% endfor %}

{% comment %} 一致到获取postsAfterFilter以及tagCountEachPost的部分都没有变化{% endcomment %}
{% comment %} 下面则使用了一个叠加for循环来逐次寻找最大的tagcount, 然后同步输出对应postsAfterFilter的值{% endcomment %}
{% if postsAfterFilter.size > 0 %}
<ul class="article-list">
{% assign j = tagCountEachPost | size | minus: 1 %}
{% assign maxIndex = 0 %}
{% assign getFirstNumber = true %}
{% assign selectedIndex = "-"|split: "-" %}
{% for p in (0..j) %}
  {% for i in (0..j) %}
    {% unless selectedIndex contains i %}
      {% if getFirstNumber %}
        {% assign firstNumber = tagCountEachPost[i] %}
        {% assign getFirstNumber = false %}
      {% endif %}
      {% if tagCountEachPost[i] >= firstNumber %}
        {% assign firstNumber = tagCountEachPost[i] %}
        {% assign maxIndex = i %}
      {% endif %}
    {% endunless %}
  {% endfor %}
  {% assign getFirstNumber = true %}
  {% assign selectedIndex = selectedIndex | push: maxIndex %}
  {% if selectedIndex.size < 6 %}
    <li><a href="{{ site.baseurl }}{{ postsAfterFilter[maxIndex]['url'] }}">{{ postsAfterFilter[maxIndex]['title'] }}</a></li>
  {% endif %}
{% endfor %}
</ul>
</div>
{% endif %}

<div style="float:right">
<h3 class="page-heading">Latest Posts:</h3>

    {% for post in site.related_posts limit:5 %}
      <li>
      <span class="post-meta">{{ post.date | date: "%b %-d, %Y" }}</span>

        <h5>
          <a href="{{ post.url | prepend: site.baseurl }}">{{ post.title }}</a>
        </h5>
      </li>
    {% endfor %}
</div>




